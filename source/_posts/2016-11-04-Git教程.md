---
title: Git教程
categories:
  - Dev
tags:
  - Git教程
date: 2016-11-04 14:03:40
---

# 安装Git
## Debian/Ubuntu
`apt-get install git`
## Centos/RedHat
`yum install git`
## Windows
安装包下载：https://git-for-windows.github.io/
## Mac
安装包下载：https://sourceforge.net/projects/git-osx-installer/

`git --version`  　查看版本

---

# Git配置
`ls -a`	或 `ls -ah`	方便查看隐藏文件
执行`git config`命令就是调用此文件
`/etc/gitconfig `       全部用户生效 --system调用的文件
`～/.gitcinfig   `      当前用户有效 --global调用的文件
`.git/config  `         当前项目的配置文件
**.git/config**的配置会覆盖**/etc/gitconfig** 中的同名变量。
win中配置文件一般在主目录下的对应用户文件夹里**C:\Documents and Settings\$USER**
win中**/etc/gitconfig**是在安装目录中。

## 用户信息配置
```
git config --global user.name "leolan"  #leolan为用户名
git config --global user.email 842632422@qq.com   #邮箱
(用了global选项后当前用户的所有项目默认使用此用户信息，某一项目若使用其它的用户信息。把--global去掉重新配置，会在该项目.git/config中重新生成配置就行了。)
以下可选：
git config --global core.editor emace   #指定emace为默认编辑器，不指定默认为vim
git config --global merge.tool vimdiff  #差异化分析工具（冲突合并），git可以理解kdiff3 ,tkdiff,meld,xxdiff,emerge,vimdiff,gvimdiff,ecmerge,opendiff等工具的输出信息。

git config user.name   #查看配置的用户名，改为user.email则为邮箱。
git config --list      #查看已配置的用户信息```

---

# 基本使用方法
**一般进入某项目的目录后再执行以下命令。**
```
git init	        #设置当前目录为Git仓库
git init 目录名 	        #指定目录为Git仓库

git clone ［源］		#从源拷贝项目到本地的当前目录
git clone ［源］［目录］	#指定源下载到某个目录
例：git clone git://github.com/schacon/grit.git mygrit

git status		#查看当前目录文件的状态，加 -s 显示简短信息。"A"是已添加到缓存、"M"为文件有改动、"空格"为未缓存的文件，组合显示如："AM"代表已缓存的文件有改动，"空格M"代表未缓存的文件有改动。
git add 文件名   #添加文件到项目缓存中，没有添加的文件不属于项目文件，也不会痛不到服务器。
git add .  		#添加当前目录到项目缓存中，如果添加多个文件，此命令更方便。
git commit -m "项目的版本或简短说明"	#可以指定版本号及简单说明改动了哪些内容，同时会把所有改动同步到服务器上。
git commit -am "项目的版本或简短说明"	#改动了多个文件又不想一个个添加，此命令自动添加所有改动的文件并同步到服务器。```

Git的所有工作都是现在本地缓存的，只有执行**git commit -m "简短说明"** 后才会向服务器提交。
```
git diff	        #未缓存的改动
git diff --cached	#已缓存的改动
git diff HEAD		#已缓存和未缓存的所有改动
git diff --stat		#显示摘要而非整个diff
git reset -- HEAD 文件	#取消文件已缓存的内容，--很重要，没有加--表示切换到另一个分支。
git rm 文件		#从项目中及本地删除文件,可不用执行。
git mv 文件		#从项目中及本地重命名文件,可不用执行。```

---
# 创建远程仓库
在继续阅读后续内容前，请自行注册GitHub账号。由于你的本地Git仓库和GitHub仓库之间的传输是通过SSH加密的，所以，需要一点设置：

* 第1步：创建SSH Key。在用户主目录下，看看有没有.ssh目录，如果有，再看看这个目录下有没有id_rsa和id_rsa.pub这两个文件，如果已经有了，可直接跳到下一步。如果没有，打开Shell（Windows下打开Git Bash），创建SSH Key：`ssh-keygen -t rsa -C "842632422@qq.com"`你需要把邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可，由于这个Key也不是用于军事目的，所以也无需设置密码。

如果一切顺利的话，可以在用户主目录里找到.ssh目录，里面有id_rsa和id_rsa.pub两个文件，这两个就是SSH Key的秘钥对，**id_rsa是私钥，不能泄露出去，id_rsa.pub是公钥**，可以放心地告诉任何人。

* 第2步：登陆GitHub，打开“Account settings”，“SSH Keys”页面：
然后，点“Add SSH Key”，填上任意Title，在Key文本框里粘贴id_rsa.pub（公钥）文件的内容：

点“Add Key”，你就应该看到已经添加的Key：
![](http://ofyfogrgx.bkt.clouddn.com//blog/git%E6%95%99%E7%A8%8B001.png)
![](http://ofyfogrgx.bkt.clouddn.com//blog/git%E6%95%99%E7%A8%8B002.png)

为什么GitHub需要SSH Key呢？因为GitHub需要识别出你推送的提交确实是你推送的，而不是别人冒充的，而Git支持SSH协议，所以，GitHub只要知道了你的公钥，就可以确认只有你自己才能推送。
当然，GitHub允许你添加多个Key。假定你有若干电脑，你一会儿在公司提交，一会儿在家里提交，只要把每台电脑的Key都添加到GitHub，就可以在每台电脑上往GitHub推送了。
最后友情提示，在GitHub上免费托管的Git仓库，任何人都可以看到喔（但只有你自己才能改）。所以，不要把敏感信息放进去。
	ssh -T git@github.com
提示：Hi MyLeoLan! You've successfully authenticated, but GitHub does not provide shell access.　　则成功添加sshkey

在右上角找到“Create a new repo”按钮，创建一个新的仓库：
![](http://ofyfogrgx.bkt.clouddn.com//blog/git%E6%95%99%E7%A8%8B003.png)
目前，在GitHub上的这个仓库还是空的，会提示你创建README.md文件。

##### 可以从这个仓库克隆出新的仓库（克隆到本地），也可以把一个已有的本地仓库与之关联，然后，把本地仓库的内容推送到GitHub仓库（本地的项目或克隆了别人的项目推送到自己的仓库，和**fork**的方式不同，这种方式要删除隐藏的**.git文件夹**因为是别人的库信息，你是推送不到自己的库上去的，删掉之后添加的才是自己的信息）。

---

# 从远程库克隆仓库
远程库已经准备好了，下一步是用命令git clone克隆一个本地库：
	git clone git@github.com:MyLeoLan/testgit.git
实际上，Git支持多种协议，默认的git://使用ssh，但也可以使用https等其他协议。
使用https除了速度慢以外，还有个最大的麻烦是**每次推送都必须输入口令**，但是在某些只开放http端口的公司内部就无法使用ssh协议而只能用https。

# 把本地仓库的内容推送到GitHub仓库
在本地的XXX仓库下运行命令：
	git remote add origin git@github.com:myleolan/learngit.git
表示把本地的XXX仓库与远程learngit.git库绑定，以后推送都推送到这个库中。地址换成自己的库地址。你的SSH Key公钥不在我的账户列表中是推不上去的。



---

# 搭建Git服务器
GitHub就是一个免费托管开源代码的远程仓库。但是对于某些视源代码如生命的商业公司来说，既不想公开源代码，又舍不得给GitHub交保护费，那就只能自己搭建一台Git服务器作为私有仓库使用。搭建Git服务器需要准备一台运行Linux的机器，强烈用Ubuntu、Debian或者Centos、redhat，这样，通过几条简单的apt命令就可以完成安装。
**root登录**

* 第一步，**安装git：**
`sudo apt-get install git` 或 `yum install git`

* 第二步，**创建一个git用户，用来运行git服务：**
`sudo adduser git`


* 第三步，**初始化Git仓库：**
先选定一个目录作为Git仓库，假定是/data/git/learngit.git
在/data/git/目录下输入命令：
`sudo git init --bare learngit.git`

Git就会创建一个裸仓库，裸仓库没有工作区，因为服务器上的Git仓库纯粹是为了共享，所以不让用户直接登录到服务器上去改工作区，并且服务器上的Git仓库通常都以.git结尾。
`sudo chown -R git:git learngit.git`

Git服务器就已经搭得差不多了。下面我们在客户端clone一下远程仓库
`git clone git@IP:/data/git/learngit.git`
Cloning into 'learngit'...
The authenticity of host '192.168.8.34 (192.168.8.34)' can't be established.
RSA key fingerprint is 2b:55:45:e7:4c:29:cc:05:33:78:03:bd:a8:cd:08:9d.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '192.168.8.34' (RSA) to the list of known hosts.
git@192.168.8.34's password:
**能连接但要密码**，接着下一步。

* **第四步，创建证书登录（Git服务器打开RSA认证）**：然后就可以去Git服务器上添加你的公钥用来验证你的信息了。`vim /etc/ssh/sshd_config`中将RSA认证打开，即：
```
RSAAuthentication yes     
PubkeyAuthentication yes     
AuthorizedKeysFile  .ssh/authorized_keys```

这里我们可以看到**公钥存放在.ssh/authorized_keys**文件中。所以我们在**/home/git下创建.ssh目录，然后创建authorized_keys文件**，收集所有需要登录的用户的公钥，就是他们自己的id_rsa.pub文件，把所有公钥导入到**/home/git/.ssh/authorized_keys文件里，一行一个。**
此时再次连接已经可以免密钥登录啦。

* **第五步，禁用shell登录：**
出于安全考虑，第二步创建的git用户不允许登录shell，这可以通过
编辑/etc/passwd文件完成。找到类似下面的一行：
`git:x:1001:1001:,,,:/home/git:/bin/bash`
改为：
`git:x:1001:1001:,,,:/home/git:/usr/bin/git-shell`

这样，git用户可以正常通过ssh使用git，但无法登录shell，因为我们为git用户指定的git-shell每次一登录就自动退出。

* 第六步，**克隆远程仓库：**
现在，可以通过git clone命令克隆远程仓库了，在各自的电脑上运行：
`git clone git@IP:/data/git/learngit.git`
Cloning into 'sample'...
warning: You appear to have cloned an empty repository.
剩下的推送就简单了。

**管理公钥**

如果团队很小，把每个人的公钥收集起来放到服务器的/home/git/.ssh/authorized_keys文件里就是可行的。如果团队有几百号人，就没法这么玩了，这时，可以用**Gitosis**来管理公钥。
这里我们不介绍怎么玩Gitosis了，几百号人的团队基本都在500强了，相信找个高水平的Linux管理员问题不大。管理公钥也可用**Gitolite**
**管理权限**
有很多不但视源代码如生命，而且视员工为窃贼的公司，会在版本控制系统里设置一套完善的权限控制，每个人是否有读写权限会精确到每个分支甚至每个目录下。因为Git是为Linux源代码托管而开发的，所以Git也继承了开源社区的精神，不支持权限控制。不过，因为**Git支持钩子（hook）**，所以，可以在服务器端编写一系列脚本来控制提交等操作，达到权限控制的目的。**Gitolite**就是这个工具。
这里我们也不介绍Gitolite了，不要把有限的生命浪费到权限斗争中。

搭建服务器的同时采用Gitolite来管理权限，参考：
https://my.oschina.net/u/2351685/blog/509322
Gitolite的使用，参考：http://www.uml.org.cn/pzgl/201404092.asp


---

参考资料：
连猴子都会的git：
http://backlogtool.com/git-guide/cn/intro/intro1_3.html
廖雪峰git：

http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000
Pro Git：
http://iissnan.com/progit/
外国友人git手册:
https://pan.baidu.com/s/1kU5OCOB#path=%252Fpub%252Fgit
10个迅速提升你 Git 水平的提示:
http://www.oschina.net/translate/10-tips-git-next-level