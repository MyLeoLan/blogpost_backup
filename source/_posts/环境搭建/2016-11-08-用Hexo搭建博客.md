---
title: 用Hexo搭建博客
categories:
  - 环境搭建
tags:
  - 用Hexo搭建博客
  - Hexo github
  - Hexo Coding
abbrlink: 23632
date: 2016-11-08 15:20:01
---

# 安装Hexo
Hexo是用node-js写的，hexo生成静态页面的速度要比较快，hexo是本地生成html再上传。

## 安装Node.js
官网下载对应平台安装包安装：https://nodejs.org  
详见：[Node.js开发环境搭建](http://leolan.top/2016/11/02/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-2016-11-02-Node-js%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/)

## 安装Hexo

```
npm install -g hexo-cli  #Mac下西安**sudo -i**切换到root权限。
hexo init blog           #blog文件夹要先建好，这一步自动生成网站。
cd blog
npm install              #安装依赖的插件。
hexo server              #运行服务
```

这时可以在浏览器打开网页。`hexo server`的简化命令为`hexo s`；指定端口：`-p xxxx`
和jekyll一样是通过修改**_config.yml**文件来配置站点信息的。（在Hexo中，根目录下的**_config.yml**文件是用来配置网站信息的；主题目录下的**_config.yml**文件是用来配置文章主题，页面等等的）

默认的目录结构如下：

```
├── .deploy       #执行hexo deploy命令部署到GitHub上的内容目录
├── public        #执行hexo generate命令，输出的静态网页内容目录
├── scaffolds     #layout模板文件目录，其中的md文件可以添加编辑
├── scripts       #扩展脚本目录，这里可以自定义一些javascript脚本
├── source        #文章源码目录，该目录下的markdown和html文件均会被hexo处理。404文件，CNAME文件等都应该放这里。
| ├── _drafts     #草稿文章
| └── _posts      #发布的文章
├── themes        #主题文件目录
├── _config.yml   #全局配置文件，大多数的设置都在这里
└── package.json  #应用程序数据，指明hexo的版本等信息。在push到github时提示*.json错误，删掉这个文件或删掉db.json就行。
```
---

# 配置优化、美化站点
Next官方设置说明：http://theme-next.iissnan.com/getting-started.html

## 站点配置
以下是我的配置文件：

```


```

## 主题配置
推荐Next主题，简单简洁，官网：http://theme-next.iissnan.com/
安装最新版：
```
cd your-hexo-site
git clone https://github.com/iissnan/hexo-theme-next themes/next```
在主题目录下可以看到next文件夹，修改**站点配置文件_config.yml**中的`theme: next`
`hexo clean && hexo s`就可以看到新主题生效啦！
接下来修改**主题配置文件_config.yml**，以下是我的配置。
```


```



## 安装插件
hexo支持插件，可以直接通过命令行安装即可：`npm install **plugin-name** --save`
更新插件
`npm update`
卸载插件
`npm uninstall **plugin-name**`
下面推荐几个常用的插件：
feed插件:`npm install hexo-generator-feed --save`
站点地图:`npm install hexo-generator-sitemap --save`
百度站点地图:`npm install hexo-generator-baidu-sitemap --save`

## 自由定制
### 文章字数、阅读时长统计
修改**post.swig**模板
**模板位置**：themes\next\layout\_macro\post.swig

安装hexo-wordcount插件
```
npm install hexo-wordcount --save```
通过以上安装后，你可以在你的模板文件后者.md文件加入以下相关的标签实现本插件的功能
**字数统计**:WordCount
```
<span class="post-count">{{ wordcount(post.content) }}</span>```

**阅读时长预计**:Min2Read
```
<span class="post-count">{{ min2read(post.content) }}</span>```
**总字数统计**: TotalCount
```
<span class="post-count">{{ totalcount(site, '0,0.0a') }}</span>```


插入的代码以下：
```
          {% if not is_index and theme.facebook_sdk.enable and theme.facebook_sdk.like_button %}
            &nbsp; | &nbsp;
            <div class="fb-like" data-layout="button_count" data-share="true"></div>
          {% endif %}
<!--从这里插入代码，上边是Facebook的代码-->
<!--leancloud文章阅读量统计（主题默认已经添加）-->
          {# LeanCould PageView #}
          {% if theme.leancloud_visitors.enable %}
             <span id="{{ url_for(post.path) }}" class="leancloud_visitors" data-flag-title="{{ post.title }}">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">{{__('post.visitors')}} </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          {% endif %}
<!--字数、阅读时长统计-->
         <span class="post-time">
     &nbsp; | &nbsp;
           <span class="post-meta-item-icon">
             <i class="fa fa-calendar-o"></i>
           </span>
           <span class="post-meta-item-text">字数统计:</span>
           <span class="post-count">{{ wordcount(post.content) }}(字)</span>          
         </span>

		<span class="post-time">
	   &nbsp; | &nbsp;
           <span class="post-meta-item-icon">
             <i class="fa fa-calendar-o"></i>
           </span>
           <span class="post-meta-item-text">阅读时长:</span>
           <span class="post-count">{{ min2read(post.content) }}(分)</span>         
         </span>
<!--不算子网站访问量统计（主题默认已经添加），如果出现排班错位请忽略，下面用官网的方法实现-->
          {% if not is_index and theme.busuanzi_count.enable and theme.busuanzi_count.page_pv %}
              &nbsp; | &nbsp;
              <span class="page-pv">{{ theme.busuanzi_count.page_pv_header }}
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>{{ theme.busuanzi_count.page_pv_footer }}
              </span>
          {% endif %}
```
### 文章结语
修改**post.swig**模板
**模板位置**：themes\next\layout\_macro\post.swig

```
          {% if post.type === 'picture' %}
            <a href="{{ url_for(post.path) }}">{{ post.content }}</a>
          {% else %}
            {{ post.content }}
          {% endif %}
        {% endif %}
      {% else %}
        {{ post.content }}
<!--这里是每篇文章的尾巴，从这里开始插入代码-->
<html>
  <body>
    <h1>结语</h1>
      <p><h5><a href="#" onclick="go_my_site()" rel="external">Leo Lan Blog Share For you!</a></h5></p>
      <p>如果您觉得本博客还不错，欢迎继续关注Leo Lan的博客，欢迎多提宝贵意见，非常感谢！</p>
  </body>
</html>
<!--下面这部分左边有框，但位置不够就会排班错乱
<html>
  <body>
    <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
    <blockquote><p>如果您觉得本博客还不错，欢迎收藏书签，欢迎多提宝贵意见，非常感谢！</p>
    <footer><strong>Welcome to LeoLan'S BLOG</strong>
    <cite><a href="#" onclick="go_my_site()" rel="external">Leo Lan Blog Share For you!</a></cite></footer></blockquote></div>
  </body>
</html>
-->```

### 文章底部的标签云锚点
修改**post.swig**模板
**模板位置**：themes\next\layout\_macro\post.swig

```
<!--这是文章底部标签云锚点，不喜欢就注释掉
    <footer class="post-footer">
      {% if post.tags and post.tags.length and not is_index %}
        <div class="post-tags">
          {% for tag in post.tags %}
            <a href="{{ url_for(tag.path) }}" rel="tag"># {{ tag.name }}</a>
          {% endfor %}
        </div>
      {% endif %}
-->```

---

### 不算子网站访问量统计、删除NEXT主题自带尾巴
修改**footer.swig**模板
**模板位置**：themes\next\layout\_partials/footer.swig
官网：http://service.ibruce.info   
http://ibruce.info/2015/04/04/busuanzi/
把代码改成这个样子，`busuanzi_value_site_uv`中，uv和pv功能是不一样的。
```
<div class="powered-by">
  {{ __('footer.powered', '') }}
</div>

<div class="theme-info">
  {{ __('footer.theme') }}<span id="busuanzi_value_site_uv"></span>位访问者
</div>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
```
同时更改语言文件中对应的名称
编辑：**themes\languages\zh_Hans.yml**
```
footer:
  powered: <a target="_blank" href="http://www.miitbeian.gov.cn/">粤ICP备16026009号-2</a>
  theme: 您是本站第```

### 留言板
编辑：**themes\languages\zh_Hans.yml**
```
title:   #这里增加
  guestbook: 留言板

menu:    #这里增加
  guestbook: 给我留言```
在站点source目录下新建guestbook文件夹，里面新建index.md文件，内容如下(其中调用HTML代码，插入了一个播放器)：
```
---
title: 留言板
date: 2016-11-14 17:21:10
---
<blockquote class="blockquote-center">
<!--网易云音乐的http地址，改为https，用https加载http资源会被屏蔽-->
    <h2>Stay Hungry,Stay Foolish</h2>
   <!--<embed src="https://music.163.com/style/swf/widget.swf?sid=34971711&type=1&auto=1&width=310&height=90" width="330" height="110"  allowNetworking="all"></embed>
   <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=110 src="https://music.163.com/outchain/player?type=1&id=34971711&auto=1&height=90"></iframe>-->
   <embed src="https://music.163.com/style/swf/widget.swf?sid=32507038&type=2&auto=1&width=320&height=66" width="340" height="86"  allowNetworking="all"></embed>
   <!--这里是插入视频的方法
	<iframe src="//www.youtube.com/embed/JMl8cQjBfqk" width="560" height="315" frameborder="0" allowfullscreen></iframe>-->
</blockquote>
<br/>
<span id="yu-2">最近访客</span>
<div class="ds-recent-visitors" data-num-items="39" data-avatar-size="40" id="ds-recent-visitors"></div>
<br/>```
**编辑主题配置文件**：_config.yml
```
menu:   #在这里加上
  guestbook: /guestbook```

---
### 打赏
修改**reward.swig**模板
**模板位置**：themes\next\layout\_macro\reward.swig

直接全部替换代码，这段代码是圆形的打赏按钮，二维码左右排列。
```
{% if theme.alipay or theme.wechatpay %}
<div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center">
  <div style="margin-bottom: 10px;font-size: 16px;font-weight: 600;">您的支持将鼓励我继续创作,非常感谢！</div>
  <button id="rewardButton", disable="enable", onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}", style="cursor: pointer; border: 0; outline: 0; border-radius: 100%; padding: 0; margin: 0; letter-spacing: normal; text-transform: none; text-indent: 0px; text-shadow: none">
    <span onmouseover="this.style.color='rgb(236,96,0)';this.style.background='rgb(204,204,204)'" onMouseOut="this.style.color='#fff';this.style.background='rgb(236,96,0)'" style="display: inline-block; width: 70px; height: 70px; border-radius: 100%; line-height: 81px; color: #fff; font: 400 35px/75px 'microsofty'; background: rgb(236,96,0)">赏</span>
  </button>
    <div id="QR" style="display: none;">
      {% if theme.alipay %}
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="{{ theme.alipay }}" alt="{{ theme.author }} Alipay" style="width: 200px; max-width: 100%; display: inline-block"/>
          <p>支付宝打赏</p>
        </div>
      {% endif %}
      {% if theme.wechatpay %}
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="{{ theme.wechatpay }}" alt="{{ theme.author }} WeChat Pay" style="width: 200px; max-width: 100%; display: inline-block"/>
          <p>微信打赏</p>
        </div>
      {% endif %}
    </div>
  </div>
{% endif %}```

### 最近访客
```
<h3 id="最近访客"><a href="#最近访客" class="headerlink" title="最近访客"></a>最近访客</h3><div class="ds-recent-visitors" data-num-items="28" data-avatar-size="42" id="ds-recent-visitors"></div>```
```
class=“ds-recent-visitors”    //指定显示最近访客容器
data-num-items=“28”    //显示最近访客的数量
data-avatar-size=“42”    //显示最近访客头像尺寸大小
id=“ds-recent-visitors”    //为了调节最近访客样式加的```
这样，每个页面都有最近访客了（只能看到注册了多说账户的用户）

### 百度网址推送
修改**baidu-push.swig**模板
**模板位置**：themes\next5.1\layout\_scripts\baidu-push.swig
没有此文件就新建
```
{% if theme.baidu_push %}
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
{% endif %}```
**编辑站点配置文件**：_config.yml
加上以下代码：
```
baidu_url_submit:  #百度链接推送，推送刚刚生成的永久链接
  count: 5 ## 比如3，代表提交最新的三个链接
  host: www.leolan.top ## 在百度站长平台中注册的域名
  token: kZ5xboXBFPxQ0g7N ## 请注意这是您的秘钥， 请不要发布在公众仓库里!
  path: /baidu_urls.txt ## 文本文档的地址， 新链接会保存在此文本文档里```


---
### 多说评论框自定义css
感谢[arao](http://www.arao.me/)的代码
进入多说管理后台
![mark](http://ofyfogrgx.bkt.clouddn.com/blog/20161115/170352768.png)
把下面代码粘贴进去保存
```
#ds-reset .ds-avatar img,
#ds-recent-visitors .ds-avatar img {
width: 54px;
height: 54px;     /*设置图像的长和宽，这里要根据自己的评论框情况更改*/
border-radius: 27px;     /*设置图像圆角效果,在这里我直接设置了超过width/2的像素，即为圆形了*/
-webkit-border-radius: 27px;     /*圆角效果：兼容webkit浏览器*/
-moz-border-radius: 27px;
box-shadow: inset 0 -1px 0 #3333sf;     /*设置图像阴影效果*/
-webkit-box-shadow: inset 0 -1px 0 #3333sf;
-webkit-transition: 0.4s;
-webkit-transition: -webkit-transform 0.4s ease-out;
transition: transform 0.4s ease-out;     /*变化时间设置为0.4秒(变化动作即为下面的图像旋转360读）*/
-moz-transition: -moz-transform 0.4s ease-out;
}

#ds-reset .ds-avatar img:hover,
#ds-recent-visitors .ds-avatar img:hover {

/*设置鼠标悬浮在头像时的CSS样式*/    box-shadow: 0 0 10px #fff;
rgba(255, 255, 255, .6), inset 0 0 20px rgba(255, 255, 255, 1);
-webkit-box-shadow: 0 0 10px #fff;
rgba(255, 255, 255, .6), inset 0 0 20px rgba(255, 255, 255, 1);
transform: rotateZ(360deg);     /*图像旋转360度*/
-webkit-transform: rotateZ(360deg);
-moz-transform: rotateZ(360deg);
}

#ds-thread #ds-reset .ds-textarea-wrapper textarea {
background: url(http://ww4.sinaimg.cn/small/649a4735gw1et7gnhy5fej20zk0m8q3q.jpg) right no-repeat;
}

#ds-recent-visitors .ds-avatar {
float: left
}
/*隐藏多说底部版权*/
#ds-thread #ds-reset .ds-powered-by {
display: none;
}```

### 动态背景

---

# 部署

```
cd your_site/
touch Staticfile  #创建静态文件标识，用于Github识别，名字必须是Staticfile
hexo clean   #清除以前生成的旧文件
hexo g       #生成新的站点文件
hexo d       #部署到Github上```
可参考：http://shomy.top/2016/03/03/hexo-in-coding-github/
部署完成打开网址就能看到效果了。

Hexo的部署只会把生成的文件上传到仓库中，本地的**设置，主题，*.md文件**等等都不会上传，换一台电脑就没法干活了，一旦删除，那基本上所有的努力都白费了，这里介绍2种备份方法：
* 1.新建一个仓库专门用来存放这些文件（最安全最方便的办法）
* 2.和发布的网站使用同一个仓库，master用来存放这些文件，新建分支来发布网站（注意pages服务绑定该分支，不要合并分支，一旦合并就全部混乱了）
两种方法都要在网站根目录设定好远程端仓库：`git add remote XXXX`
每次发布完网页，就顺手执行以下代码，把文档也同步到仓库中。
```
git add .
git commit -m "xxx"
git push
```

---

# 绑定域名
原理和博客绑定域名是一样的

* 1· 在你的项目下新建一个**CNAME**文件，注意没有后缀名。在里面添加你的域名，如我的就是** leolan.top**，然后推送**CNAME文件**到远程仓库。（方法二是直接在pages页上找到域名绑定设置，最好同时绑定如：**leolan.top**和**www.leolan.top**,少绑一个，没绑的那个打不开）
* 2· 到域名服务商那里增加你的CNAME记录。添加两条记录，@和www的主机记录，记录类型为CNAME，记录值为 `username.github.io. `，重要的是 io 后面还有一个原点（看官方帮助文档Coding的就不用加点），切记。
![](http://ofyfogrgx.bkt.clouddn.com//blog/%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A.png)
过几分钟，刷新网页，就能直接用域名访问了，因为是在项目内建的**CNAME**文件，所以域名直接指向此项目文件夹，其他项目可以用其他域名设定。

---

# 参考资料
[Hexo](http://www.joryhe.com/tags/hexo/) 　　　 [Jekyll迁移到Hexo](http://www.ezlippi.com/blog/2016/02/jekyll-to-hexo.html)

---